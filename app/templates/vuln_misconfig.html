{% extends "base.html" %}
{% block title %}セキュリティ設定ミス - Vulnerable App{% endblock %}
{% block content %}
<h3 class="vuln-header">7. セキュリティ設定ミス</h3>

<div class="row mt-3">
    <div class="col-lg-8">
        <div class="card mb-3">
            <div class="card-body">
                <h5>概要</h5>
                <p>デバッグモードの有効化、秘密鍵のハードコード、ディレクトリリスティング、
                   デフォルト認証情報の使用など、本番環境での設定不備を体験します。</p>
                <span class="badge bg-warning text-dark">OWASP A05:Misconfiguration</span>
                <span class="badge bg-secondary">IPA: 設定管理の不備</span>
            </div>
        </div>

        {% if info %}
        <div class="card mb-3">
            <div class="card-body">
                <h5>検出された設定ミス</h5>
                <table class="table table-bordered">
                    <tr>
                        <th>デバッグモード</th>
                        <td>
                            {% if info.debug_mode %}
                            <span class="badge bg-danger">有効 (True)</span>
                            — Werkzeugデバッガが使えます: <a href="/console" target="_blank">/console</a>
                            {% else %}
                            <span class="badge bg-success">無効</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>秘密鍵</th>
                        <td class="text-danger"><code>{{ info.secret_key }}</code>（ハードコードされています）</td>
                    </tr>
                    <tr>
                        <th>サーバーヘッダ</th>
                        <td>{{ info.server_header }}（バージョン情報が露出）</td>
                    </tr>
                    <tr>
                        <th>デフォルト認証情報</th>
                        <td class="text-danger">{{ info.default_credentials }}</td>
                    </tr>
                </table>
            </div>
        </div>
        {% endif %}

        {% if directory %}
        <div class="card mb-3">
            <div class="card-body">
                <h5>ディレクトリリスティング: /files/</h5>
                <ul>
                    {% for f in files %}
                    <li><a href="/files/{{ f }}">{{ f }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}

        <div class="card mb-3">
            <div class="card-body">
                <h5>確認ポイント</h5>
                <ul>
                    <li><a href="/console" target="_blank">/console</a> — Werkzeugデバッガ（Pythonコード実行可能）</li>
                    <li><a href="/files/" target="_blank">/files/</a> — ディレクトリリスティング</li>
                    <li><a href="/admin" target="_blank">/admin</a> — デフォルト認証情報 admin/admin123</li>
                </ul>
            </div>
        </div>

        <div class="accordion hint-section" id="hintMisconfig">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mis1">
                        ヒント1: デバッガ
                    </button>
                </h2>
                <div id="mis1" class="accordion-collapse collapse" data-bs-parent="#hintMisconfig">
                    <div class="accordion-body">
                        <code>/console</code> にアクセスすると、Werkzeugの対話型デバッガが使えます。
                        <code>import os; os.popen('id').read()</code> などのPythonコードが実行できます。
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mis2">
                        ヒント2: 対策
                    </button>
                </h2>
                <div id="mis2" class="accordion-collapse collapse" data-bs-parent="#hintMisconfig">
                    <div class="accordion-body">
                        <ul>
                            <li>本番環境では <code>debug=False</code> にする</li>
                            <li>秘密鍵は環境変数から読み込む: <code>os.environ.get('SECRET_KEY')</code></li>
                            <li>ディレクトリリスティングを無効化する</li>
                            <li>デフォルトのパスワードを変更する</li>
                            <li>サーバーヘッダのバージョン情報を隠す</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
