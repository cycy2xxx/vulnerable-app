{% extends "base.html" %}
{% block title %}機密情報の露出 - Vulnerable App{% endblock %}
{% block content %}
<h3 class="vuln-header">5. 機密情報の露出</h3>

<div class="row mt-3">
    <div class="col-lg-8">
        <div class="card mb-3">
            <div class="card-body">
                <h5>概要</h5>
                <p>APIレスポンスやHTMLページに、パスワード、クレジットカード番号、秘密メモなどの
                   機密情報がフィルタリングされずに含まれている問題です。</p>
                <span class="badge bg-info">OWASP A02:Cryptographic Failures</span>
                <span class="badge bg-secondary">IPA: 出力値の扱い不備</span>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-body">
                <h5>体験: ユーザー一覧（機密情報つき）</h5>
                <table class="table table-bordered table-sm table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th><th>ユーザー名</th><th>パスワード</th>
                            <th>メール</th><th>カード番号</th><th>秘密メモ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in users %}
                        <tr>
                            <td>{{ u.id }}</td>
                            <td>{{ u.username }}</td>
                            <td class="text-danger">{{ u.password }}</td>
                            <td>{{ u.email }}</td>
                            <td class="text-danger">{{ u.credit_card }}</td>
                            <td class="text-danger">{{ u.secret_note }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-body">
                <h5>APIエンドポイント</h5>
                <p><a href="/api/users" target="_blank" class="btn btn-outline-primary btn-sm">/api/users</a>
                   をブラウザで開いて、JSONレスポンスを確認してください。</p>
                <p class="text-muted small">開発者ツール (F12) → Network タブでも確認できます。</p>
            </div>
        </div>

        <div class="attack-example mb-3">
            <h6>問題点</h6>
            <ul class="small mb-0">
                <li>APIが全フィールド（パスワード、カード番号、秘密メモ含む）を返している</li>
                <li>HTMLページにも機密情報がそのまま表示されている</li>
                <li>APIにアクセス制御がない（認証なしでアクセス可能）</li>
                <li>パスワードが平文で保存・送信されている</li>
            </ul>
        </div>

        <div class="accordion hint-section" id="hintExposure">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exp1">
                        ヒント1: APIを確認
                    </button>
                </h2>
                <div id="exp1" class="accordion-collapse collapse" data-bs-parent="#hintExposure">
                    <div class="accordion-body">
                        <code>/api/users</code> にアクセスしてみてください。
                        JSON形式で全ユーザーの全フィールドが返されます。
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exp2">
                        ヒント2: 対策
                    </button>
                </h2>
                <div id="exp2" class="accordion-collapse collapse" data-bs-parent="#hintExposure">
                    <div class="accordion-body">
                        APIレスポンスには必要最小限のフィールドのみ含めるべきです。
                        <code>SELECT id, username, email FROM users</code> のように必要なカラムだけ取得します。
                        パスワードはハッシュ化し、カード番号はマスク処理（****-****-****-1111）を行います。
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
